{% extends "base.html" %}

{% block title %}Mapa de Red de Agentes - AGP Dashboard{% endblock %}

{% block content %}
<div class="container-fluid p-4">
    <h1 class="h3 mb-4 text-gray-800">Mapa de Red de Agentes</h1>
    <div class="card shadow mb-4">
        <div class="card-header py-3">
            <h6 class="m-0 font-weight-bold text-primary">Visualizaci칩n Interactiva</h6>
        </div>
        <div class="card-body">
            <div id="agent-network" style="height: 70vh; width: 100%;"></div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
{{ super() }}
<script type="text/javascript">
    document.addEventListener('DOMContentLoaded', function() {
        const container = document.getElementById('agent-network');
        
        // Opciones de configuraci칩n para un look futurista
        const options = {
            nodes: {
                borderWidth: 2,
                font: {
                    color: '#e9e9e9',
                    size: 14,
                    face: 'monospace'
                }
            },
            edges: {
                color: {
                    color: '#555',
                    highlight: '#0d6efd'
                },
                width: 2,
                smooth: {
                    type: 'continuous'
                }
            },
            physics: {
                enabled: true,
                barnesHut: {
                    gravitationalConstant: -10000,
                    centralGravity: 0.1,
                    springLength: 150,
                    springConstant: 0.05,
                    damping: 0.09
                },
                solver: 'barnesHut'
            },
            interaction: {
                hover: true,
                tooltipDelay: 200
            }
        };

        // Funci칩n para cargar y dibujar la red
        function drawNetwork() {
            fetch("{{ url_for('enterprise.agent_network_data') }}")
                .then(response => response.json())
                .then(data => {
                    const network = new vis.Network(container, data, options);
                })
                .catch(error => {
                    console.error('Error fetching network data:', error);
                    container.innerHTML = '<div class="alert alert-danger">No se pudo cargar el mapa de red.</div>';
                });
        }

        // Dibujar la red al cargar la p치gina
        drawNetwork();

        // Opcional: Recargar la red cada 30 segundos para actualizar el estado
        setInterval(drawNetwork, 30000);
    });
</script>
{% endblock %}
